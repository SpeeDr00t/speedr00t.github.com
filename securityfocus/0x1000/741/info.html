#bid741<p><b><span style="font-size: 18pt;">Squid Web Proxy Authentication Failure Vulnerability</span></b></p><br><br><a href="http://www.securityfocus.com/bid/741/info">info</a><br><a href="http://www.securityfocus.com/bid/741/discuss">discussion</a><br><a href="http://www.securityfocus.com/bid/741/exploit">exploit</a><br><a href="http://www.securityfocus.com/bid/741/solution">solution</a><br><a href="http://www.securityfocus.com/bid/741/references">references</a><br><br><br><br><br>#<br>#<div id="vulnerability">
<span class="title"></span><br/><br/>
<table border="0" cellpadding="4" cellspacing="0">
<tr>
<td>
<span class="label">Bugtraq ID:</span>
</td>
<td>
				741
			</td>
</tr>
<tr>
<td>
<span class="label">Class:</span>
</td>
<td>
				Origin Validation Error
			</td>
</tr>
<tr valign="top">
<td>
<span class="label">CVE:</span>
</td>
<td>
</td>
</tr>
<tr>
<td>
<span class="label">Remote:</span>
</td>
<td>
				Yes
			</td>
</tr>
<tr>
<td>
<span class="label">Local:</span>
</td>
<td>
				No
			</td>
</tr>
<tr>
<td>
<span class="label">Published:</span>
</td>
<td>
				Oct 25 1999 12:00AM
			</td>
</tr>
<tr>
<td>
<span class="label">Updated:</span>
</td>
<td>
				Oct 25 1999 12:00AM
			</td>
</tr>
<tr>
<td>
<span class="label">Credit:</span>
</td>
<td>
				This was discovered by Oezguer Kesim &lt;oec@CODEBLAU.DE&gt; and posted to the Bugtraq mailing list on Mon, 25 Oct 1999.
			</td>
</tr>
<tr valign="top">
<td>
<span class="label">Vulnerable:</span>
</td>
<td>
				
					National Science Foundation Squid Web Proxy 2.2 <br/>
<span class="related">
						
							-
						
						Redhat Linux 6.0  sparc<br/>
</span>
<span class="related">
						
							-
						
						Redhat Linux 6.0  alpha<br/>
</span>
<span class="related">
						
							-
						
						Redhat Linux 6.0 <br/>
</span>
<span class="related">
						
							-
						
						Redhat Linux 5.2  sparc<br/>
</span>
<span class="related">
						
							-
						
						Redhat Linux 5.2  i386<br/>
</span>
<span class="related">
						
							-
						
						Redhat Linux 5.2  alpha<br/>
</span>
					
				
					National Science Foundation Squid Web Proxy 2.1 <br/>
					
				
					National Science Foundation Squid Web Proxy 1.1 <br/>
					
				
					National Science Foundation Squid Web Proxy 1.0 NOVM<br/>
					
				
					National Science Foundation Squid Web Proxy 1.0 <br/>
</td>
</tr>
<tr>
<td colspan="2">
<div class="breakline"></div>
</td>
</tr>
<tr valign="top">
<td>
<span class="label">Not Vulnerable:</span>
</td>
<td>
				
					National Science Foundation Squid Web Proxy 2.3 <br/>
<span class="related">
						
							+ 
						
						Redhat Linux 7.1  ia64<br/>
</span>
<span class="related">
						
							+ 
						
						Redhat Linux 7.1  i386<br/>
</span>
<span class="related">
						
							+ 
						
						Redhat Linux 7.1  alpha<br/>
</span>
<span class="related">
						
							+ 
						
						Redhat Linux 7.0  i386<br/>
</span>
<span class="related">
						
							+ 
						
						Redhat Linux 7.0  alpha<br/>
</span>
<span class="related">
						
							+ 
						
						Redhat Linux 6.2  sparc<br/>
</span>
<span class="related">
						
							+ 
						
						Redhat Linux 6.2  i386<br/>
</span>
<span class="related">
						
							+ 
						
						Redhat Linux 6.2  alpha<br/>
</span>
<span class="related">
						
							+ 
						
						S.u.S.E. Linux 7.3 sparc<br/>
</span>
<span class="related">
						
							+ 
						
						S.u.S.E. Linux 7.3 ppc<br/>
</span>
<span class="related">
						
							+ 
						
						S.u.S.E. Linux 7.3 i386<br/>
</span>
<span class="related">
						
							+ 
						
						S.u.S.E. Linux 7.2 i386<br/>
</span>
<span class="related">
						
							+ 
						
						S.u.S.E. Linux 7.1 x86<br/>
</span>
<span class="related">
						
							+ 
						
						S.u.S.E. Linux 7.1 sparc<br/>
</span>
<span class="related">
						
							+ 
						
						S.u.S.E. Linux 7.1 ppc<br/>
</span>
<span class="related">
						
							+ 
						
						S.u.S.E. Linux 7.1 alpha<br/>
</span>
<span class="related">
						
							+ 
						
						S.u.S.E. Linux 7.0 sparc<br/>
</span>
<span class="related">
						
							+ 
						
						S.u.S.E. Linux 7.0 ppc<br/>
</span>
<span class="related">
						
							+ 
						
						S.u.S.E. Linux 7.0 i386<br/>
</span>
<span class="related">
						
							+ 
						
						S.u.S.E. Linux 7.0 alpha<br/>
</span>
<span class="related">
						
							+ 
						
						S.u.S.E. Linux 6.4 ppc<br/>
</span>
<span class="related">
						
							+ 
						
						S.u.S.E. Linux 6.4 i386<br/>
</span>
<span class="related">
						
							+ 
						
						S.u.S.E. Linux 6.4 alpha<br/>
</span>
<span class="related">
						
							+ 
						
						SCO Open Server 5.0.6 a<br/>
</span>
<span class="related">
						
							+ 
						
						SCO Open Server 5.0.6 <br/>
</span>
<span class="related">
						
							+ 
						
						SCO Open Server 5.0.5 <br/>
</span>
<span class="related">
						
							+ 
						
						SCO Open Server 5.0.4 <br/>
</span>
<span class="related">
						
							+ 
						
						SCO Open Server 5.0.3 <br/>
</span>
<span class="related">
						
							+ 
						
						SCO Open Server 5.0.2 <br/>
</span>
<span class="related">
						
							+ 
						
						SCO Open Server 5.0.1 <br/>
</span>
<span class="related">
						
							+ 
						
						SCO Open Server 5.0 <br/>
</span>
</td>
</tr>
</table>
</div><br><br>#<br>##no_exploit_link<br><br><br><br>#<br>#<div id="vulnerability">
<span class="title"></span><br/><br/>
	Assumptions:<br/>~~~~~~~~~~~~<br/><br/>1.)  You use plain squid-2.2-STABLE5 or below. Also, external authentication is active using a some external authentication program, which basically follows the implementation guidelines given on the squid-webpages.<br/><br/>2.)  Your ACL's for external authentication apply often enough so that external authentication actually happens maybe every 20 seconds to 20 minutes. This also depends on your password-cache settings.<br/><br/>3.) In general, users enter correct user:password pairs.<br/><br/>4.)  No other user has sent a user:passwd pair with a newline at the end to the proxy until now (so we can actually describe the effect when it occurs the first time).<br/><br/><br/>The exploit:<br/>~~~~~~~~~~~~<br/><br/>1.) Create a base64-encoded "user:passwd\n" string, f.e.:<br/>        # echo "foo:bar" | mimencode<br/>        # Zm9vOmJhcgo=<br/><br/>    Note that<br/>        # echo -n "foo:bar" | mimencode<br/>    (notice the -n option!) will strip the trailing newline and can't be used.<br/> <br/> The newline at the end is essential for the exploit, since most external authenticators will read _two_ lines from the proxy and sent _two_ results back to the proxy, shifting all subsequent responses to authentication request by one.<br/><br/>2.)  telnet to your proxy and sent a valid but not authorized request (lines marked with a * are your input lines):<br/><br/>        # telnet proxy 8080<br/>        Trying 123.123.123.123<br/>        Connected to proxy.home.net<br/>        Escape character is '^'<br/>      * GET http://some.domain.net HTTP/1.0<br/>      * Proxy-Authorization: Basic Zm9vOmJhcgo=<br/>      *<br/>     Please notice the last extra newline needed for the Protocol (it has nothing to do with the exploit, though).<br/><br/> An ACL must match the given domain (here, some.domain.net), which uses the external authentication program.<br/><br/>3.)  You will see the response for you user:passwd pair and due to assumption this answer is accurate.<br/><br/> Now, wait. Once a different user sents his user:password pair -- which in turn is correct in general as stated in assumption 3.) -- he will get the authentication response of _your_ empty line and most probably will be a  HTTP/1.0 407 Proxy Authentication Required answer, but then, the user will try again and... get the _correct_ answer of his or her _first_ try.<br/><br/> Now, the second answer (which most probably will be OK) is pending!<br/><br/>4.)  Try to connect again with another fake user:password (without extra newline), most likely using your favorite browser. Now you should profit from the pending OK in step 3 and get the page you want.<br/><br/> Thats it. Please notice, that when caching is active, you can surf as long the name:password pair is available in the cache -- which can be quite long.<br/><br/>This is a direct quote from a Bugtraq post by Oezguer Kesim which is available in the 'Credit' section of this vulnerability entry.
	
		<ul>
</ul>
</div>