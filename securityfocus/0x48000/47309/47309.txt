if (isset($_FILES)) { //upload attachments
  ...snip...
   $invalidFileTypes = array('php', 'php3', 'php4', 'php5', 'exe', 'dll', 'so', 'htaccess');
   $uploaddir = $eforum->path.'/upload';
   $upfiles = $_FILES['efattachment'];
     foreach ($upfiles['name'] as $idx => $upname) {
       if ($upname != '') {
         $source = $upfiles['tmp_name'][$idx];
           if (is_uploaded_file($source)) {
             if (in_array($fmanager->FileExt($upname), $invalidFileTypes)) { continue; }